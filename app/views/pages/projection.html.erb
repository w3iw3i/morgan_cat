<% if user_signed_in? %>
  <% expenses = Expense.where(user_id: current_user.id).select([:year_int, :inflated_amt]) %>

  <%  data = [
    {
      name: "Cash",
      data: @projected_amt
    },
    {
      name: "Stocks",
      data: @stocks_projection
    },
    {
      name: "Bonds",
      data: @bonds_projection
    },
    {
      name: "CPF-Ordinary",
      data: @cpfo_projection
    },
    {
      name: "CPF-Special",
      data: @cpfs_projection
    },
    {
      name: "CPF-Medisave",
      data: @cpfm_projection
    }
  ]
  %>

  <%=

      # integrate expenses into projection
      expenses.to_a.each do |expense|
        data.first[:data].each do |cash|
          if expense[:year_int].to_s == cash[0]
            cash[1] -= expense[:inflated_amt]
          end
        end
      end

      column_chart data,
      title: 'Asset Projection', stacked:true, ytitle: "Net Worth($)", min:-1000, thousands: ",", loading: "Loading...",
      library: {
        yAxis: {
            labels: {
                format: '${value}'
            }
        },
            tooltip: {
              pointFormat: 'Total Spent: <b>{point.y}</b>',
              xDateFormat: '%B',
              valuePrefix: '$'
            }
          }
  %>
<% else %>
  <%= column_chart @projected_amt,
      title: 'Asset Projection', stacked:true, ytitle: "Net Worth($)", min:-1000, thousands: ",", loading: "Loading...",
      library: {
        yAxis: {
            labels: {
                format: '${value}'
            }
        },
            tooltip: {
              pointFormat: 'Total Spent: <b>{point.y}</b>',
              xDateFormat: '%B',
              valuePrefix: '$'
            }
          }
  %>
<% end %>

<%= link_to "Back to Home", root_path, class: 'btn btn-primary' %>
